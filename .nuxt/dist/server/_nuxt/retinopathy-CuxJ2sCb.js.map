{"version":3,"file":"retinopathy-CuxJ2sCb.js","sources":["../../../../app/pages/retinopathy.vue"],"sourcesContent":["<template>\r\n  <section class=\"retino\">\r\n    <header class=\"retino__header\">\r\n      <h1 class=\"retino__title\">Diabetic Retinopathy (floaters + patches)</h1>\r\n      <p class=\"retino__lead\">\r\n        Diabetic retinopathy can cause blurry areas, dark patches, and floaters.\r\n        This simulation overlays moving “floaters” and patchy blur while you try\r\n        to read and click the correct label.\r\n      </p>\r\n\r\n      <div class=\"controls\" aria-label=\"Retinopathy controls\">\r\n        <label class=\"controls__label\" for=\"severity\">\r\n          Severity: <strong>{{ severity }}</strong>\r\n        </label>\r\n        <input\r\n          id=\"severity\"\r\n          class=\"controls__range\"\r\n          type=\"range\"\r\n          min=\"0\"\r\n          max=\"10\"\r\n          step=\"1\"\r\n          v-model.number=\"severity\"\r\n        />\r\n      </div>\r\n    </header>\r\n\r\n    <main class=\"retino__main\">\r\n      <section class=\"game\" aria-label=\"Read the label mini-game\">\r\n        <div class=\"game__top\" aria-live=\"polite\">\r\n          <p class=\"game__prompt\">\r\n            Task: Click the label <strong>“{{ target }}”</strong>\r\n          </p>\r\n          <p class=\"game__score\">\r\n            Score: <strong>{{ score }}</strong> | Mistakes: <strong>{{ mistakes }}</strong>\r\n          </p>\r\n        </div>\r\n\r\n        <div class=\"stage\" :style=\"stageStyle\" @mousemove=\"onMove\">\r\n          <div class=\"overlay\" aria-hidden=\"true\">\r\n            <div\r\n              v-for=\"f in floaters\"\r\n              :key=\"f.id\"\r\n              class=\"floater\"\r\n              :style=\"{\r\n                left: `${f.x}%`,\r\n                top: `${f.y}%`,\r\n                transform: `translate(-50%,-50%) scale(${f.s})`\r\n              }\"\r\n            />\r\n            <div\r\n              v-for=\"p in patches\"\r\n              :key=\"p.id\"\r\n              class=\"patch\"\r\n              :style=\"{\r\n                left: `${p.x}%`,\r\n                top: `${p.y}%`,\r\n                width: `${p.r}px`,\r\n                height: `${p.r}px`,\r\n                transform: 'translate(-50%,-50%)'\r\n              }\"\r\n            />\r\n          </div>\r\n\r\n          <div class=\"labels\">\r\n            <button\r\n              v-for=\"l in labels\"\r\n              :key=\"l\"\r\n              type=\"button\"\r\n              class=\"label\"\r\n              @click=\"pick(l)\"\r\n            >\r\n              {{ l }}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <p class=\"game__hint\">\r\n          Tip: Increase severity and notice how “easy reading” becomes slow and\r\n          frustrating.\r\n        </p>\r\n      </section>\r\n\r\n      <section class=\"info\">\r\n        <h2>What this can represent</h2>\r\n        <ul>\r\n          <li>Blurred or missing patches</li>\r\n          <li>Floaters that drift across the field of view</li>\r\n          <li>Harder reading / recognizing small text</li>\r\n        </ul>\r\n      </section>\r\n    </main>\r\n  </section>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { computed, onMounted, onUnmounted, ref, watch } from 'vue'\r\n\r\ntype Floater = { id: number; x: number; y: number; vx: number; vy: number; s: number }\r\ntype Patch = { id: number; x: number; y: number; r: number }\r\n\r\nconst severity = ref(5)\r\nconst score = ref(0)\r\nconst mistakes = ref(0)\r\n\r\nconst allLabels = ['INSULIN', 'WATER', 'EXIT', 'HELP', 'CLINIC', 'PHARMACY']\r\nconst labels = ref<string[]>([])\r\nconst target = ref('EXIT')\r\n\r\nconst floaters = ref<Floater[]>([])\r\nconst patches = ref<Patch[]>([])\r\nlet raf: number | null = null\r\nlet nextId = 1\r\n\r\nconst randomBetween = (min: number, max: number) => Math.random() * (max - min) + min\r\n\r\nconst remakeRound = () => {\r\n  // Pick 4 labels\r\n  const shuffled = [...allLabels].sort(() => Math.random() - 0.5)\r\n  labels.value = shuffled.slice(0, 4)\r\n  target.value = labels.value[Math.floor(Math.random() * labels.value.length)]\r\n}\r\n\r\nconst rebuildOverlay = () => {\r\n  const s = severity.value\r\n  const floaterCount = Math.round((s / 10) * 10) // 0..10\r\n  const patchCount = Math.round((s / 10) * 6) // 0..6\r\n\r\n  floaters.value = Array.from({ length: floaterCount }, () => {\r\n    const id = nextId++\r\n    return {\r\n      id,\r\n      x: randomBetween(5, 95),\r\n      y: randomBetween(10, 90),\r\n      vx: randomBetween(-0.02, 0.02),\r\n      vy: randomBetween(-0.015, 0.015),\r\n      s: randomBetween(0.8, 1.8),\r\n    }\r\n  })\r\n\r\n  patches.value = Array.from({ length: patchCount }, () => {\r\n    const id = nextId++\r\n    return {\r\n      id,\r\n      x: randomBetween(10, 90),\r\n      y: randomBetween(15, 85),\r\n      r: randomBetween(90, 180) + s * 6,\r\n    }\r\n  })\r\n}\r\n\r\nconst step = () => {\r\n  const s = severity.value\r\n  const speed = 1 + (s / 10) * 2\r\n  for (const f of floaters.value) {\r\n    f.x += f.vx * 60 * speed\r\n    f.y += f.vy * 60 * speed\r\n    if (f.x < -10) f.x = 110\r\n    if (f.x > 110) f.x = -10\r\n    if (f.y < -10) f.y = 110\r\n    if (f.y > 110) f.y = -10\r\n  }\r\n  raf = window.requestAnimationFrame(step)\r\n}\r\n\r\nconst pick = (label: string) => {\r\n  if (label === target.value) {\r\n    score.value++\r\n    remakeRound()\r\n  } else {\r\n    mistakes.value++\r\n  }\r\n}\r\n\r\nconst stageStyle = computed(() => {\r\n  const s = severity.value\r\n  const blur = (s / 10) * 7\r\n  const contrast = 1 - (s / 10) * 0.25\r\n  return {\r\n    '--stage-blur': `${blur.toFixed(2)}px`,\r\n    '--stage-contrast': contrast.toFixed(2),\r\n    '--overlay-opacity': (0.05 + (s / 10) * 0.22).toFixed(3),\r\n  } as Record<string, string>\r\n})\r\n\r\nconst onMove = () => {\r\n  // placeholder: if later you want cursor-driven glare/blur, we can do it here\r\n}\r\n\r\nwatch(severity, () => {\r\n  rebuildOverlay()\r\n})\r\n\r\nonMounted(() => {\r\n  remakeRound()\r\n  rebuildOverlay()\r\n\r\n  if (typeof window !== 'undefined') {\r\n    window.dispatchEvent(\r\n      new CustomEvent('blindsite:achievement', {\r\n        detail: { key: 'retino', text: 'Patchy vision: you opened diabetic retinopathy.' },\r\n      })\r\n    )\r\n  }\r\n\r\n  raf = window.requestAnimationFrame(step)\r\n})\r\n\r\nonUnmounted(() => {\r\n  if (raf) window.cancelAnimationFrame(raf)\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.retino {\r\n  display: grid;\r\n  gap: 2.5rem;\r\n}\r\n\r\n.retino__header {\r\n  max-width: 52rem;\r\n  display: grid;\r\n  gap: 1rem;\r\n}\r\n\r\n.retino__title {\r\n  font-size: clamp(2.2rem, 3.5vw, 2.8rem);\r\n}\r\n\r\n.retino__lead {\r\n  color: #e5e7eb;\r\n  line-height: 1.6;\r\n}\r\n\r\n.controls {\r\n  display: grid;\r\n  gap: 0.35rem;\r\n  max-width: 28rem;\r\n}\r\n\r\n.controls__label {\r\n  color: #e5e7eb;\r\n}\r\n\r\n.controls__range {\r\n  width: 100%;\r\n}\r\n\r\n.retino__main {\r\n  display: grid;\r\n  gap: 2.5rem;\r\n}\r\n\r\n.game {\r\n  max-width: 52rem;\r\n}\r\n\r\n.game__top {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  justify-content: space-between;\r\n  gap: 0.75rem;\r\n  color: #e5e7eb;\r\n  margin-bottom: 0.75rem;\r\n}\r\n\r\n.stage {\r\n  position: relative;\r\n  border-radius: 1rem;\r\n  border: 1px solid rgba(148, 163, 184, 0.4);\r\n  background: linear-gradient(180deg, rgba(15, 23, 42, 0.75), rgba(2, 6, 23, 0.92));\r\n  padding: 1.25rem;\r\n  overflow: hidden;\r\n  filter: blur(var(--stage-blur)) contrast(var(--stage-contrast));\r\n}\r\n\r\n.labels {\r\n  position: relative;\r\n  z-index: 1;\r\n  display: grid;\r\n  grid-template-columns: repeat(2, minmax(0, 1fr));\r\n  gap: 1rem;\r\n}\r\n\r\n.label {\r\n  border-radius: 1rem;\r\n  border: 1px solid rgba(148, 163, 184, 0.55);\r\n  background: rgba(15, 23, 42, 0.7);\r\n  color: rgba(248, 250, 252, 0.92);\r\n  padding: 1.15rem;\r\n  font-size: 1.25rem;\r\n  font-weight: 800;\r\n  letter-spacing: 0.08em;\r\n  cursor: pointer;\r\n}\r\n\r\n.label:hover,\r\n.label:focus-visible {\r\n  outline: none;\r\n  border-color: rgba(251, 191, 36, 0.85);\r\n}\r\n\r\n.overlay {\r\n  position: absolute;\r\n  inset: 0;\r\n  z-index: 2;\r\n  pointer-events: none;\r\n  opacity: var(--overlay-opacity);\r\n}\r\n\r\n.floater {\r\n  position: absolute;\r\n  width: 110px;\r\n  height: 110px;\r\n  border-radius: 999px;\r\n  background:\r\n    radial-gradient(circle, rgba(0, 0, 0, 0.65), rgba(0, 0, 0, 0.0) 68%),\r\n    radial-gradient(circle, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0) 62%);\r\n  filter: blur(1px);\r\n  mix-blend-mode: multiply;\r\n}\r\n\r\n.patch {\r\n  position: absolute;\r\n  border-radius: 999px;\r\n  background:\r\n    radial-gradient(circle, rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0.15) 55%, rgba(0, 0, 0, 0.0) 74%);\r\n  filter: blur(8px);\r\n  mix-blend-mode: multiply;\r\n}\r\n\r\n.game__hint {\r\n  margin-top: 0.75rem;\r\n  color: #e5e7eb;\r\n  opacity: 0.9;\r\n}\r\n\r\n.info {\r\n  max-width: 52rem;\r\n  color: #e5e7eb;\r\n  line-height: 1.6;\r\n}\r\n\r\n.info h2 {\r\n  font-size: 1.3rem;\r\n  margin-bottom: 0.5rem;\r\n}\r\n\r\n.info ul {\r\n  padding-left: 1.25rem;\r\n  margin: 0;\r\n}\r\n\r\n.info li + li {\r\n  margin-top: 0.4rem;\r\n}\r\n</style>\r\n"],"names":["_ssrRenderAttrs","_mergeProps","_ssrRenderList"],"mappings":";;;;;;;;;;;;;;;;;;;AAoGA,UAAM,WAAW,IAAI,CAAC;AACtB,UAAM,QAAQ,IAAI,CAAC;AACnB,UAAM,WAAW,IAAI,CAAC;AAGtB,UAAM,SAAS,IAAc,EAAE;AAC/B,UAAM,SAAS,IAAI,MAAM;AAEzB,UAAM,WAAW,IAAe,EAAE;AAClC,UAAM,UAAU,IAAa,EAAE;AAE/B,QAAI,SAAS;AAEb,UAAM,gBAAgB,CAAC,KAAa,QAAgB,KAAK,YAAY,MAAM,OAAO;AASlF,UAAM,iBAAiB,MAAM;AAC3B,YAAM,IAAI,SAAS;AACnB,YAAM,eAAe,KAAK,MAAO,IAAI,KAAM,EAAE;AAC7C,YAAM,aAAa,KAAK,MAAO,IAAI,KAAM,CAAC;AAE1C,eAAS,QAAQ,MAAM,KAAK,EAAE,QAAQ,aAAA,GAAgB,MAAM;AAC1D,cAAM,KAAK;AACX,eAAO;AAAA,UACL;AAAA,UACA,GAAG,cAAc,GAAG,EAAE;AAAA,UACtB,GAAG,cAAc,IAAI,EAAE;AAAA,UACvB,IAAI,cAAc,OAAO,IAAI;AAAA,UAC7B,IAAI,cAAc,QAAQ,KAAK;AAAA,UAC/B,GAAG,cAAc,KAAK,GAAG;AAAA,QAAA;AAAA,MAE7B,CAAC;AAED,cAAQ,QAAQ,MAAM,KAAK,EAAE,QAAQ,WAAA,GAAc,MAAM;AACvD,cAAM,KAAK;AACX,eAAO;AAAA,UACL;AAAA,UACA,GAAG,cAAc,IAAI,EAAE;AAAA,UACvB,GAAG,cAAc,IAAI,EAAE;AAAA,UACvB,GAAG,cAAc,IAAI,GAAG,IAAI,IAAI;AAAA,QAAA;AAAA,MAEpC,CAAC;AAAA,IACH;AAyBA,UAAM,aAAa,SAAS,MAAM;AAChC,YAAM,IAAI,SAAS;AACnB,YAAM,OAAQ,IAAI,KAAM;AACxB,YAAM,WAAW,IAAK,IAAI,KAAM;AAChC,aAAO;AAAA,QACL,gBAAgB,GAAG,KAAK,QAAQ,CAAC,CAAC;AAAA,QAClC,oBAAoB,SAAS,QAAQ,CAAC;AAAA,QACtC,sBAAsB,OAAQ,IAAI,KAAM,MAAM,QAAQ,CAAC;AAAA,MAAA;AAAA,IAE3D,CAAC;AAMD,UAAM,UAAU,MAAM;AACpB,qBAAA;AAAA,IACF,CAAC;;uBA7LUA,eAAAC,WAAA,EAAA,OAAM,SAAA,GAAQ,MAAA,CAAA,wjBAWM,SAAA,KAAQ,+HASb,SAAA,KAAQ,4TASY,OAAA,KAAM,wGAGtB,MAAA,KAAK,iEAAoC,SAAA,KAAQ,gEAI5C,WAAA,KAAU;AAGnBC,oBAAA,SAAA,QAAL,MAAC;;UAG4B,MAAA,GAAA,EAAE,CAAC;AAAA,UAA8B,KAAA,GAAA,EAAE,CAAC;AAAA,UAA+D,WAAA,8BAAA,EAAE,CAAC;AAAA,QAAA;;;AAO9HA,oBAAA,QAAA,QAAL,MAAC;;UAG4B,MAAA,GAAA,EAAE,CAAC;AAAA,UAA8B,KAAA,GAAA,EAAE,CAAC;AAAA,UAAgC,OAAA,GAAA,EAAE,CAAC;AAAA,UAAkC,QAAA,GAAA,EAAE,CAAC;AAAA;;;;AAYpIA,oBAAA,OAAA,QAAL,MAAC;oFAML,CAAC,CAAA,WAAA;AAAA;;;;;;;;;;;;"}